(function(){if(window.AEJSBridge){return}var bridgeIframe;var untreatedDispatchMsgs=[];var eventCallbacks={};var dispatchCallbacks={};var CUSTOM_PROTOCOL_SCHEME="yy";var QUEUE_HAS_MESSAGE="__QUEUE_MESSAGE__/";var uniqueId=1;function _createQueueReadyIframe(doc){bridgeIframe=doc.createElement("iframe");bridgeIframe.style.display="none";doc.documentElement.appendChild(bridgeIframe)}function addEventListener(req){if(!req.exec&&req.callback){req.exec=req.callback;req.callback=null}if(!req||!req.handlerName||!req.exec){return}if(!eventCallbacks[req.handlerName]){eventCallbacks[req.handlerName]=[]}eventCallbacks[req.handlerName].push(req.exec);if(req.callback){req.callback({msg:"add success ~",code:0})}}function removeEventListener(req){if(!req||!req.handlerName||!req.exec){return}var callArray=eventCallbacks[req.handlerName];var delSuccess=false;for(var index=0;index<callArray.length;index++){if(callArray[index]===req.exec){callArray.splice(index,1);delSuccess=true;break}}if(req.callback){req.callback({msg:delSuccess?"delete success ~":"delete failed ~",code:delSuccess?0:-1})}}function dispatch(req){console.log("dispatchï¼š"+req);if(!req||!req.handlerName){return}if(req.callback){var callbackId="cb_"+(uniqueId++)+"_"+new Date().getTime();dispatchCallbacks[callbackId]=req.callback;req.callbackId=callbackId}untreatedDispatchMsgs.push(req);bridgeIframe.src=CUSTOM_PROTOCOL_SCHEME+"://"+QUEUE_HAS_MESSAGE}function dispatchSync(req){if(!req||!req.handlerName){return}console.log(JSON.stringify(req.params));var res=(AEJSBridgeSync.dispatchSync(req.handlerName,JSON.stringify(req.params)));console.log(res);try{return JSON.parse(res)}catch(e){return res}}function _fetchQueue(){var messageQueueString=JSON.stringify(untreatedDispatchMsgs);untreatedDispatchMsgs=[];bridgeIframe.src=CUSTOM_PROTOCOL_SCHEME+"://return/_fetchQueue/"+encodeURIComponent(messageQueueString)}function _dispatchMessageFromNative(messageJSON){setTimeout(function(){var msg=JSON.parse(messageJSON);var responseCallback;var data;try{data=JSON.parse(msg.data)}catch(e){data=msg.data}if(msg.responseId){responseCallback=dispatchCallbacks[msg.responseId];if(!responseCallback){return}responseCallback({data:decodeURIComponent(data),msg:msg.msg,code:msg.code});delete dispatchCallbacks[msg.responseId]}else{if(msg.callbackId){var callbackResponseId=msg.callbackId;responseCallback=function(res){untreatedDispatchMsgs.push({responseId:callbackResponseId,data:res});bridgeIframe.src=CUSTOM_PROTOCOL_SCHEME+"://"+QUEUE_HAS_MESSAGE}}var callbacks;if(!msg.handlerName){console.log("handlerName is empty ...");return}callbacks=eventCallbacks[msg.handlerName];if(!callbacks){console.log("handlerName callbacks is empty ...");return}callbacks.forEach(function(item){item({data:decodeURIComponent(data),msg:msg.msg,code:msg.code},responseCallback)})}})}function _handleMessageFromNative(messageJSON){_dispatchMessageFromNative(messageJSON)}var AEJSBridge=window.AEJSBridge={addEventListener:addEventListener,removeEventListener:removeEventListener,dispatch:dispatch,dispatchSync:dispatchSync,_fetchQueue:_fetchQueue,_handleMessageFromNative:_handleMessageFromNative};var doc=document;_createQueueReadyIframe(doc);var readyEvent=doc.createEvent("Events");readyEvent.initEvent("AEJSBridgeReady");readyEvent.bridge=AEJSBridge;doc.dispatchEvent(readyEvent)})();